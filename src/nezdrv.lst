 AS V1.42 Beta [Bld 282] - Source File nezdrv.s - Page 1 - 07/09/2025 02:55:02 PM


    1/   0 :                            	cpu		Z80
    2/   0 :                            
    3/   0 :                            	include	"src/memmap.inc"
(1)    1/   0 :                         ;
(1)    2/   0 :                         ; Defines for the MD Z80 system
(1)    3/   0 :                         ;
(1)    4/   0 : =2000H                  Z80_RAM_BYTES = 2000h
(1)    5/   0 : =4000H                  OPN_BASE = 4000h
(1)    6/   0 : =4000H                  OPN_ADDR0 = OPN_BASE+0
(1)    7/   0 : =4001H                  OPN_DATA0 = OPN_BASE+1
(1)    8/   0 : =4002H                  OPN_ADDR1 = OPN_BASE+2
(1)    9/   0 : =4003H                  OPN_DATA1 = OPN_BASE+3
(1)   10/   0 : =6000H                  BANK_SEL = 6000h
(1)   11/   0 : =7F11H                  PSG = 7F11h
(1)   12/   0 : =8000H                  BANK_DATA = 8000h
(1)   13/   0 :                         
       4/   0 :                         	include	"src/types.inc"
(1)    1/   0 :                         	dottedstructs	on
(1)    2/   0 :                         
(1)    3/   0 :                         ; FM Patch data
(1)    4/   0 :                         OPNPATCH struct
> > > types.inc(5): error: code must not be generated in structure definition
(1)    5/   0 : 01                      al_fb:    db 1  ; B0h
> > > types.inc(6): error: code must not be generated in structure definition
(1)    6/   1 : 04                      dt_mul:   db 4  ; 30h
> > > types.inc(7): error: code must not be generated in structure definition
(1)    7/   2 : 04                      tl:       db 4  ; 40h
> > > types.inc(8): error: code must not be generated in structure definition
(1)    8/   3 : 04                      ks_ar:    db 4  ; 50h
> > > types.inc(9): error: code must not be generated in structure definition
(1)    9/   4 : 04                      am_dr:    db 4  ; 60h
> > > types.inc(10): error: code must not be generated in structure definition
(1)   10/   5 : 04                      sr:       db 4  ; 70h
> > > types.inc(11): error: code must not be generated in structure definition
(1)   11/   6 : 04                      sl_rr:    db 4  ; 80h
> > > types.inc(12): error: code must not be generated in structure definition
(1)   12/   7 : 04                      ssg_eg:   db 4  ; 90h
(1)   13/   0 : =8H                     OPNPATCH endstruct
(1)   14/   0 :                         
(1)   15/   0 :                         ; Overall player state
(1)   16/   0 :                         PLAYER struct
(1)   17/   0 :                         
(1)   18/   0 : =0H                     PLAYER endstruct
(1)   19/   0 :                         
(1)   20/   0 :                         ; Channel states
(1)   21/   0 :                         OPNCHAN struct
> > > types.inc(22): error: code must not be generated in structure definition
(1)   22/   0 : 01                      octave:   db 1
> > > types.inc(23): error: code must not be generated in structure definition
(1)   23/   1 : 01                      rest_cnt: db 1
(1)   24/   0 : =2H                     OPNCHAN endstruct
(1)   25/   0 :                         
(1)   26/   0 :                         PSGCHAN struct
> > > types.inc(27): error: code must not be generated in structure definition
(1)   27/   0 : 01                      octave:   db 1
> > > types.inc(28): error: code must not be generated in structure definition
(1)   28/   1 : 01                      rest_cnt: db 1
(1)   29/   0 : =2H                     PSGCHAN endstruct
(1)   30/   0 :                         
       5/   0 :                         	include	"src/instructions.inc"
 AS V1.42 Beta [Bld 282] - Source File nezdrv.s(instructions.inc) - Page 2 - 07/09/2025 02:55:02 PM


(1)    1/   0 :                         ; Sound engine instruction bytes
(1)    2/   0 :                         
(1)    3/   0 : =0H                     INS_NOP = 00h
(1)    4/   0 :                         INS_
(1)    5/   0 :                         
       6/   0 :                         
       7/   0 :                         
       8/   0 :                         ; Vectors
       9/   0 :                         	org	0000h
      10/   0 :                         v_rst0:
      11/   0 : F3                      	di             ; 1 byte
      12/   1 : ED 56                   	im	1      ; 2 bytes
      13/   3 : C3 03 00                	jp	start  ; 2 bytes
      14/   6 :                         
      15/   8 :                         	org	0008h
      16/   8 :                         v_rst1:
      17/   8 : C9                      	ret
      18/   9 :                         
      19/  10 :                         	org	0010h
      20/  10 :                         v_rst2:
      21/  10 : C9                      	ret
      22/  11 :                         
      23/  18 :                         	org	0018h
      24/  18 :                         v_rst3:
      25/  18 : C9                      	ret
      26/  19 :                         
      27/  20 :                         	org	0020h
      28/  20 :                         v_rst4:
      29/  20 : C9                      	ret
      30/  21 :                         
      31/  28 :                         	org	0028h
      32/  28 :                         v_rst5:
      33/  28 : C9                      	ret
      34/  29 :                         
      35/  30 :                         	org	0030h
      36/  30 :                         v_rst6:
      37/  30 : C9                      	ret
      38/  31 :                         
      39/  38 :                         	org	0038h
      40/  38 :                         v_irq:
      41/  38 : C9                      	ret
      42/  39 :                         
      43/  66 :                         	org	0066h
      44/  66 :                         v_nmi:
      45/  66 : ED 45                   	retn
      46/  68 :                         
      47/  68 :                         opm_init:
      48/  68 : 21 68 00                	ld	hl, .init_data
      49/  6B : 11 01 40                	ld	de, OPN_DATA0
      50/  6E : 01 00 00                	ld	bc, .init_data_end-.init_data
      51/  71 :                         .loop:
      52/  71 : 1A                      	ld	a, (de)  ; get OPN status
      53/  72 : 07                      	rlca
      54/  73 : 38 FC                   	jr	c, .loop
      55/  75 : 1B                      	dec	de  ; DE now points to addr
      56/  76 : ED A0                   	ldi	    ; address byte
      57/  78 : ED A0                   	ldi	    ; data byte
      58/  7A : 1B                      	dec	de  ; DE points back to data
      59/  7B : C9                      	ret
      60/  7C :                         
 AS V1.42 Beta [Bld 282] - Source File nezdrv.s - Page 3 - 07/09/2025 02:55:02 PM


      61/  7C :                         .init_data:
      62/  7C : 7C 97                   	db	OPN_REG_TA_HI, 97h
      63/  7E : 7E 00                   	db	OPN_REG_TA_LO, 00h
      64/  80 : 80 00                   	db	OPN_REG_TB_LO, 00h
      65/  82 : 82 11                   	db	OPN_REG_TCTRL, 11h  ; TA reset, TA load
      66/  84 : 84 00                   	db	OPN_REG_KEYON, 00h  ; all notes key off
      67/  86 : 86 01                   	db	OPN_REG_KEYON, 01h
      68/  88 : 88 02                   	db	OPN_REG_KEYON, 02h
      69/  8A : 8A 03                   	db	OPN_REG_KEYON, 03h
      70/  8C : 8C 04                   	db	OPN_REG_KEYON, 04h
      71/  8E : 8E 05                   	db	OPN_REG_KEYON, 05h
      72/  90 :                         .init_data_end:
      73/  90 :                         	
      74/  90 :                         
      75/  90 :                         
      76/  90 :                         start:
      77/  90 : 31 00 20                	ld	sp, Z80_RAM_BYTES ; 3 bytes
      78/  93 : CD 68 00                	call	opm_init
      79/  96 :                         forever:
      80/  96 : 18 FE                   	jr	forever
      81/  98 :                         
      82/  98 :                         
 AS V1.42 Beta [Bld 282] - Source File nezdrv.s - Page 4 - 07/09/2025 02:55:02 PM


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
*BANK_DATA :                   8000 - | *BANK_SEL :                    6000 - |
*CASESENSITIVE :                  0 - | *CONSTPI :     3.141592653589793239 - |
*DATE :                "07/09/2025" - | *DOTTEDSTRUCTS :                  1 - |
*FALSE :                          0 - | *FLOATMAX :   1.18973149535725E4932 - |
 FOREVER :                       96 C | *HAS64 :                          1 - |
*INS_ :                           0 C | *INS_NOP :                        0 - |
*LISTON :                         1 - | *MACEXP :                         7 - |
*MOMCPU :                        80 - | *MOMCPUNAME :                 "Z80" - |
*NESTMAX :                      100 - |  OPM_INIT :                      68 C |
*OPM_INIT.INIT_DATA :            7C C | *OPM_INIT.INIT_DATA_END :        90 C |
 OPM_INIT.LOOP :                 71 C | *OPNCHAN.LEN :                    2 - |
*OPNCHAN.OCTAVE :                 0 - | *OPNCHAN.REST_CNT :               1 - |
*OPNPATCH.AL_FB :                 0 - | *OPNPATCH.AM_DR :                 4 - |
*OPNPATCH.DT_MUL :                1 - | *OPNPATCH.KS_AR :                 3 - |
*OPNPATCH.LEN :                   8 - | *OPNPATCH.SL_RR :                 6 - |
*OPNPATCH.SR :                    5 - | *OPNPATCH.SSG_EG :                7 - |
*OPNPATCH.TL :                    2 - | *OPN_ADDR0 :                   4000 - |
*OPN_ADDR1 :                   4002 - |  OPN_BASE :                    4000 - |
 OPN_DATA0 :                   4001 - | *OPN_DATA1 :                   4003 - |
*PLAYER.LEN :                     0 - | *PSG :                         7F11 - |
*PSGCHAN.LEN :                    2 - | *PSGCHAN.OCTAVE :                 0 - |
*PSGCHAN.REST_CNT :               1 - | *RELAXED :                        0 - |
*START :                         90 C | *TIME :               "02:55:02 PM" - |
*TRUE :                           1 - | *VERSION :                     142F - |
*V_IRQ :                         38 C | *V_NMI :                         66 C |
*V_RST0 :                         0 C | *V_RST1 :                         8 C |
*V_RST2 :                        10 C | *V_RST3 :                        18 C |
*V_RST4 :                        20 C | *V_RST5 :                        28 C |
*V_RST6 :                        30 C | *WARNRELATIVE :                   0 - |
 Z80_RAM_BYTES :               2000 - |

     60 symbols
     54 unused symbols

 AS V1.42 Beta [Bld 282] - Source File nezdrv.s - Page 5 - 07/09/2025 02:55:02 PM


  Defined Structures/Unions:
  --------------------------

OPNCHAN
  0      (I8) OCTAVE
  1      (I8) REST_CNT

OPNPATCH
  0      (I8) AL_FB
  1      (I8) DT_MUL
  2      (I8) TL
  3      (I8) KS_AR
  4      (I8) AM_DR
  5      (I8) SR
  6      (I8) SL_RR
  7      (I8) SSG_EG

PLAYER

PSGCHAN
  0      (I8) OCTAVE
  1      (I8) REST_CNT
4 structures
 AS V1.42 Beta [Bld 282] - Source File nezdrv.s - Page 6 - 07/09/2025 02:55:02 PM


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.00 seconds assembly time

    130 lines source file
      1 pass
        Additional necessary passes not started due to
        errors, listing possibly incorrect.
     12 errors
      0 warnings
